/* =============================================================================
   test02 (unRLEWBtoVRAM Assembler in line)
   v1.1 (09 April 2022)
   
   Description:
    test output data from MSX TILES devtool v1
    and test unRLEWBtoVRAM library (RLEWB to VRAM decompress) 
    at Assembler in line mode (call assembler routine and datas)

  Historic of versions:
  - v1.1 (09 April 2022) update libraries
  - v1.0 (27 June 2014) first version
============================================================================= */

#include "../include/newTypes.h"
#include "../include/msxBIOS.h"

#include "../include/VDP_TMS9918A_MSXROM.h"
#include "../include/unRLEWBtoVRAM.h"




#define  HALT __asm halt __endasm   //wait for the next interrupt




//------------------------------------------------------ definition of functions
void WAIT(uint cicles);
char INKEY();
char Random();

void print0(char column, char line, char* text); //print in screen 0
void print(char column, char line, char* text);  //print in screen 1 or 2
void vprint(uint vaddr, char* text);

void test_decompress();
void showPicture();



//-------------------------------------------------------------------- variables

char RNDSEED;



// Functions -------------------------------------------------------------------


//
void main(void)
{
  SCREEN(1);
  COLOR(15,4,4);

  HALT;
  print(1, 9,"Test MSXTILESdevtool v1 and");
  print(1,10,"SDCC unRLEWBtoVRAM Lib");
  print(1,11,"(Assembler in line)");  
  
  WAIT(220);
     
  test_decompress();
  
  return;
}



/* =============================================================================
One character input (waiting)
============================================================================= */
char INKEY() __naked
{
__asm
  push IX   
  call CHGET
  ld   L,A
  pop  IX
  ret
__endasm;
}



// Generates a pause in the execution of n interruptions.
// PAL: 50=1second. ; NTSC: 60=1second. 
void WAIT(uint cicles)
{
  uint i;
  for(i=0;i<cicles;i++) HALT;
  return;
}



/* =============================================================================
 Random
 Description: Gives you a random number
 Input:       -
 Output:     [char]
============================================================================= */  
char Random() __naked
{
__asm

  ld   A,(_RNDSEED)
  
  SRA  A  

  add	 A,A
  add	 A,A
	
  ld   B,A	
  ld   A,R
  add  A,B

  inc  A 
      
  ld   (_RNDSEED),A
   
  ld   L,A
 
  ret  
__endasm;
}



//print in screen 0
void print0(char column, char line, char* text)
{
  uint vaddr = BASE0 + (line*40)+column; // calcula la posicion en la VRAM
  vprint(vaddr, text);
}



//print in screen 1 or 2
void print(char column, char line, char* text)
{
  uint vaddr = BASE10 + (line*32)+column; // calcula la posicion en la VRAM
  vprint(vaddr, text);
}



void vprint(uint vaddr, char* text)
{
  while(*(text)) VPOKE(vaddr++,*(text++));
}





void test_decompress()
{
  char color;

  COLOR(0,0,1);
  SCREEN(2);
  
  showPicture();

  while(1) //to infinity and beyond!
  {
    //HALT;
    color = Random()>>4;
    COLOR(0,0,color);    
  }
   
}




void showPicture() __naked
{
__asm 

  halt
  ld   HL,#TILESET_pat
  ld   DE,#BASE12
  call unRLEWBVRAM
  
  ld   HL,#TILESET_col
  ld   DE,#BASE11
  call unRLEWBVRAM

  ret
  

; mSXdevtool v1.0.9.0
; File: image_for_test02.png
; Tileset Pattern data All BANKs
; RLE WB compressed - Original size=6144 - Compress size=1272
TILESET_pat:
.db 0x80,0xFE,0x00,0x80,0x0A,0x00,0x01,0x03,0x07,0x0F,0x1F,0x3F,0x0F,0x7F,0x80,0xD5
.db 0xFF,0xF0,0xFE,0x80,0x05,0xFF,0x00,0x00,0x80,0x00,0xC0,0xE0,0xF0,0xF8,0xFC,0x80
.db 0x0F,0x00,0x3F,0x80,0x02,0x7F,0x80,0x03,0xFF,0x07,0x1F,0x3F,0x7F,0x7F,0x80,0xD2
.db 0xFF,0xE0,0xF8,0xFC,0xFE,0xFE,0x80,0x02,0xFF,0x03,0x80,0x02,0x01,0x80,0x03,0x00
.db 0x80,0x0F,0xFF,0x80,0x07,0x00,0x80,0xDF,0xFF,0x80,0x07,0x00,0x80,0x0F,0xFF,0x80
.db 0x07,0x00,0x80,0xDF,0xFF,0x80,0x07,0x00,0x80,0x0F,0xFF,0x80,0x07,0x00,0x80,0x0F
.db 0xFF,0x80,0x07,0xC0,0x80,0x07,0x07,0x80,0x07,0xFE,0x80,0x07,0x01,0x80,0x0E,0xFF
.db 0x80,0x00,0x80,0x06,0xFF,0x00,0x80,0x06,0xC0,0x00,0x80,0x07,0xFF,0x80,0x07,0xC0
.db 0x80,0x07,0x00,0x80,0x07,0x07,0x80,0x07,0xFE,0x80,0x11,0x00,0x01,0x03,0x07,0x0F
.db 0x0F,0x1F,0x0F,0x7F,0x80,0x03,0xFF,0xFE,0xFC,0xFC,0x80,0x04,0xFF,0x1F,0x0F,0x00
.db 0x80,0x00,0xE0,0xF0,0xF8,0xFC,0xFC,0xFE,0x80,0x37,0x00,0x80,0x1F,0xFF,0x80,0x07
.db 0x00,0x80,0x07,0xFF,0x80,0x07,0xC0,0x80,0x07,0x07,0x80,0x07,0xFE,0x80,0x07,0x01
.db 0x80,0x07,0xFF,0x80,0x07,0x80,0x80,0x0F,0x00,0x80,0x07,0xFF,0x80,0x07,0xC0,0x80
.db 0x07,0x00,0x80,0x07,0x07,0x80,0x07,0xFE,0x80,0x0F,0x00,0x1F,0x1F,0x80,0x05,0x3F
.db 0xF8,0xF8,0x80,0x05,0xF0,0x07,0x07,0x80,0x05,0x03,0xFE,0xFE,0x80,0x05,0xFF,0x80
.db 0x37,0x00,0x80,0x1F,0xFF,0x80,0x07,0x00,0x80,0x0E,0xFF,0xC0,0x80,0x06,0xFF,0x07
.db 0x80,0x07,0xFE,0x80,0x07,0x01,0x80,0x0E,0xFF,0x80,0x00,0x80,0x06,0xFC,0x80,0x08
.db 0x00,0x80,0x07,0xFF,0x80,0x07,0xC0,0x80,0x07,0x00,0x80,0x07,0x07,0x80,0x07,0xFE
.db 0x80,0x0F,0x00,0x80,0x07,0x3F,0x80,0x07,0xF0,0x80,0x07,0x03,0x80,0x07,0xFF,0x80
.db 0x37,0x00,0x80,0x1F,0xFF,0x80,0x07,0x00,0x80,0x07,0xFF,0x80,0x07,0xC0,0x80,0x07
.db 0x07,0x80,0x07,0xFE,0x80,0x07,0x01,0x80,0x07,0xFF,0x80,0x07,0x80,0x80,0x0F,0x00
.db 0x80,0x07,0xFF,0x80,0x07,0xC0,0x80,0x07,0x00,0x80,0x07,0x07,0x80,0x07,0xFE,0x80
.db 0x0F,0x00,0x80,0x05,0x3F,0x1F,0x1F,0x80,0x05,0xF0,0xF8,0xF8,0x80,0x05,0x03,0x07
.db 0x07,0x80,0x05,0xFF,0xFE,0xFE,0x80,0x37,0x00,0x80,0x1F,0xFF,0x80,0x07,0x00,0x80
.db 0x07,0xFF,0x80,0x07,0xC0,0x80,0x07,0x07,0x80,0x07,0xFE,0x80,0x07,0x01,0x80,0x07
.db 0xFF,0x80,0x00,0x80,0x06,0xFF,0x00,0x80,0x06,0xFF,0x00,0x80,0x06,0xC0,0x80,0x07
.db 0xFF,0xC0,0x80,0x06,0xFF,0x00,0x80,0x06,0xFF,0x07,0x80,0x06,0x87,0xFE,0x80,0x06
.db 0xFF,0x00,0x80,0x06,0xFF,0x00,0x80,0x06,0xFC,0x1F,0x0F,0x0F,0x07,0x03,0x01,0x00
.db 0x00,0xFC,0xFE,0x80,0x03,0xFF,0x7F,0x0F,0x0F,0x1F,0x80,0x04,0xFF,0xFC,0xFE,0xFC
.db 0xFC,0xF8,0xF0,0xE0,0x80,0x00,0x80,0x38,0x00,0x80,0x1F,0xFF,0x80,0xDF,0x00,0x80
.db 0x1F,0xFF,0x80,0xDF,0x00,0x80,0x1F,0xFF,0x80,0xDF,0x00,0x80,0x1F,0xFF,0x80,0x07
.db 0x00,0xFF,0xFF,0x80,0x03,0x7F,0x3F,0x3F,0xC0,0xC0,0x80,0x03,0xE0,0xF0,0xF0,0x0F
.db 0x0F,0x80,0x03,0x1F,0x3F,0x3F,0xFC,0xFC,0x80,0x03,0xFE,0xFF,0xFF,0x00,0x00,0x80
.db 0x03,0x01,0x03,0x03,0x80,0x07,0xFF,0xC0,0xC0,0x80,0x02,0x80,0x81,0x01,0x03,0x01
.db 0x0F,0x3F,0x7F,0x80,0x09,0xFF,0xC3,0x81,0x80,0x00,0xF0,0xFC,0xFE,0x80,0x03,0xFF
.db 0x80,0x04,0x00,0x80,0x01,0x80,0xC0,0x80,0x07,0x1F,0x80,0x06,0xFF,0xF8,0x80,0x06
.db 0xFF,0x0F,0x00,0xE0,0xF8,0xFC,0xFE,0xFE,0xFF,0xFF,0x80,0x07,0x00,0x80,0x07,0xFF
.db 0x80,0x07,0xC0,0x80,0x07,0x00,0x80,0x07,0x07,0x80,0x06,0xFF,0xFE,0x80,0x06,0xFF
.db 0x0F,0x80,0x00,0xF0,0xFC,0xFE,0x80,0x03,0xFF,0x80,0x04,0x00,0x80,0x01,0x80,0xC0
.db 0x80,0x04,0x07,0x80,0x02,0x03,0x80,0x04,0xFF,0x80,0x02,0xFE,0x80,0x07,0x00,0x80
.db 0x1F,0xFF,0x80,0x07,0x00,0x3F,0x3F,0x80,0x03,0x1F,0x0F,0x0F,0xF0,0xF0,0x80,0x03
.db 0xF8,0xFC,0xFC,0x3F,0x3F,0x80,0x03,0x7F,0x80,0x09,0xFF,0x03,0x03,0x80,0x03,0x87
.db 0xCF,0xCF,0xFF,0xFF,0x80,0x03,0xFE,0xFC,0xFC,0x03,0x03,0x80,0x05,0x07,0xFF,0xFF
.db 0x80,0x05,0xFE,0x80,0x07,0x00,0xFF,0xFF,0x80,0x05,0x7F,0xC0,0xC0,0x80,0x05,0xE0
.db 0x80,0x07,0x1F,0x80,0x07,0xF8,0x03,0x80,0x05,0x01,0x03,0x80,0x07,0xFF,0x00,0x80
.db 0x05,0x80,0x00,0x80,0x07,0xFF,0x80,0x07,0xC0,0x80,0x07,0x00,0x80,0x07,0x07,0x80
.db 0x07,0xFE,0x03,0x01,0x01,0x80,0x04,0x00,0x80,0x05,0xFF,0x7F,0x7F,0xC0,0xC0,0x80
.db 0x05,0xE0,0x80,0x05,0x03,0x01,0x01,0x80,0x05,0xFE,0xFC,0xFC,0x80,0x07,0x00,0x80
.db 0x1F,0xFF,0x80,0x07,0x00,0x0F,0x0F,0x80,0x03,0x07,0x03,0x03,0xFC,0xFC,0x80,0x13
.db 0xFF,0x3F,0x3F,0xCF,0xCF,0x80,0x05,0xFF,0xFC,0xFC,0x80,0x03,0xF8,0xF0,0xF0,0x80
.db 0x07,0x07,0x80,0x07,0xFE,0x80,0x07,0x00,0x80,0x07,0x7F,0x80,0x07,0xE0,0x80,0x07
.db 0x1F,0xF8,0x80,0x06,0xFF,0x0F,0x80,0x08,0xFF,0xFE,0xFE,0xFC,0xF8,0xF0,0xC0,0x80
.db 0x07,0x00,0x80,0x07,0xFF,0x80,0x07,0xC0,0x80,0x07,0x00,0x80,0x07,0x07,0x80,0x07
.db 0xFE,0x80,0x07,0x00,0x80,0x07,0x7F,0x80,0x07,0xE0,0x80,0x06,0x01,0x00,0x80,0x06
.db 0xFC,0xF8,0x80,0x07,0x00,0x80,0x1F,0xFF,0x80,0x07,0x00,0x03,0x03,0x80,0x03,0x01
.db 0x00,0x00,0x80,0x09,0xFF,0x80,0x03,0xFE,0xFC,0xFC,0x3F,0x3F,0x80,0x03,0x1F,0x0F
.db 0x0F,0x80,0x07,0xFF,0xF0,0xF0,0x80,0x03,0xE0,0xC0,0xC0,0x80,0x05,0x07,0x03,0x03
.db 0x80,0x05,0xFE,0xFF,0xFF,0x80,0x07,0x00,0x80,0x05,0x7F,0xFF,0xFF,0x80,0x05,0xE0
.db 0xC0,0xC0,0x80,0x07,0x1F,0x80,0x07,0xF8,0x7F,0x7F,0x3F,0x3F,0x1F,0x1F,0x0F,0x0F
.db 0xE0,0xE0,0xF0,0xF0,0xF8,0xF8,0xFC,0xFC,0x80,0x07,0x00,0x80,0x07,0xFF,0x80,0x07
.db 0xC0,0x80,0x07,0x00,0x80,0x07,0x07,0x80,0x07,0xFE,0x80,0x04,0x00,0x01,0x01,0x03
.db 0x7F,0x7F,0x80,0x05,0xFF,0x80,0x05,0xE0,0xC0,0xC0,0x80,0x06,0x00,0x01,0x80,0x03
.db 0xF8,0x80,0x02,0x00,0xFC,0x80,0x07,0x00,0x80,0x1F,0xFF,0x80,0x0F,0x00,0xFF,0xFF
.db 0x80,0x03,0x7F,0x3F,0x3F,0xFC,0xFC,0x80,0x03,0xF8,0xF0,0xF0,0x0F,0x0F,0x80,0x03
.db 0x07,0x03,0x03,0x80,0x07,0xFF,0xC0,0xC0,0x80,0x03,0x80,0x00,0x00,0x03,0x01,0x01
.db 0x80,0x04,0x00,0x80,0x03,0xFF,0x7F,0x3F,0x0F,0x01,0x81,0xC3,0x80,0x09,0xFF,0xFE
.db 0xFC,0xF0,0x80,0x00,0xC0,0x80,0x01,0x80,0x80,0x04,0x00,0x80,0x07,0x1F,0x80,0x07
.db 0xF8,0x07,0x07,0x03,0x03,0x01,0x01,0x00,0x00,0xFE,0xFE,0x80,0x05,0xFF,0x80,0x03
.db 0x00,0x80,0x01,0x80,0xC0,0xC0,0x80,0x07,0xFF,0xC0,0x80,0x06,0xFF,0x00,0x80,0x06
.db 0xFF,0x07,0x80,0x06,0x87,0xFE,0x80,0x06,0xFF,0x0F,0x80,0x0A,0xFF,0xFE,0xFC,0xF0
.db 0x80,0x00,0xC0,0x80,0x01,0x80,0x80,0x04,0x00,0x80,0x06,0x03,0x01,0x80,0x06,0xFE
.db 0xFC,0x80,0x07,0x00,0x80,0x1F,0xFF,0x80,0xDF,0x00,0x80,0x1B,0xFF,0x80,0x02,0x80
.db 0xC0,0x80,0x02,0xFF,0x7F,0x7F,0x3F,0x1F,0x07,0x80,0xD2,0xFF,0xFE,0xFE,0xFC,0xF8
.db 0xE0,0x80,0x03,0x00,0x80,0x02,0x01,0x03,0x80,0x0F,0xFF,0xC0,0xE0,0xF0,0xF8,0xFC
.db 0xFE,0xFF,0xFF,0x80,0x05,0x00,0x80,0x00,0xF0,0x80,0x07,0x00,0x01,0x80,0x06,0x00
.db 0x80,0x08,0xFF,0xFE,0xFC,0xF8,0xF0,0xE0,0xC0,0x80,0x01,0x80,0x80,0xB4,0x00,0x01
.db 0x0F,0x03,0x07,0x0F,0x1F,0x3F,0x7F,0x80,0x29,0xFF,0x80,0x07,0x00,0xFF,0xFE,0xFC
.db 0xF8,0xF0,0xE0,0xC0,0x80,0x04,0x00,0x01,0x03,0x07,0x0F,0x0F,0x3F,0x7F,0x80,0xE4
.db 0xFF,0x80,0x06,0x00,0x80,0x00,0x80,0x03,0x00,0x01,0x03,0x07,0x1F,0x1F,0x3F,0x7F
.db 0x80,0xFE,0xFF,0x80,0xCD,0xFF,0x80,0xFF

; mSXdevtool v1.0.9.0
; File: image_for_test02.png
; Tileset Color data All BANKs
; RLE WB compressed - Original size=6144 - Compress size=209
TILESET_col:
.db 0x80,0xFE,0x00,0x80,0x0A,0x00,0x80,0xFE,0x70,0x80,0x06,0x70,0x80,0xDF,0xD7,0x80
.db 0x1F,0x07,0x80,0xE7,0xD7,0x80,0x17,0x07,0x80,0xE7,0xD7,0x80,0x17,0x07,0x80,0x07
.db 0xD7,0x80,0x07,0xF7,0x80,0xCF,0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80,0x0F,0x7D
.db 0x80,0xD7,0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80,0x0F,0x7D,0x80,0xD7,0xFD,0x80
.db 0x07,0x7D,0x80,0x0F,0x0D,0x80,0x0F,0x7D,0x80,0xD7,0xFD,0x80,0x07,0x7D,0x80,0x0F
.db 0x0D,0x80,0x0F,0x7D,0x80,0xD7,0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80,0xEF,0x7D
.db 0x80,0x0F,0x0D,0x80,0xEF,0x7D,0x80,0x0F,0x0D,0x80,0xEF,0x7D,0x80,0x0F,0x0D,0x80
.db 0x0F,0x7D,0x80,0xD7,0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80,0x0F,0x7D,0x80,0xD7
.db 0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80,0x0F,0x7D,0x80,0xD7,0xFD,0x80,0x07,0x7D
.db 0x80,0x0F,0x0D,0x80,0x0F,0x7D,0x80,0xD7,0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80
.db 0x17,0x7D,0x80,0xCF,0xFD,0x80,0x07,0x7D,0x80,0x0F,0x0D,0x80,0xEF,0x7D,0x80,0x0F
.db 0x0D,0x80,0x03,0x7D,0x80,0x03,0x07,0x80,0xE3,0xD7,0x80,0x2B,0x07,0x80,0xCD,0xD7
.db 0x80,0x39,0x07,0x80,0x0B,0xD7,0x80,0xFE,0x07,0x80,0xFE,0x07,0x80,0xCD,0x07,0x80
.db 0xFF

__endasm;
}